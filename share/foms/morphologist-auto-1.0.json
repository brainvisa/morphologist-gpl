{
    "fom_name": "morphologist-auto-1.0",

    "fom_import": ["formats-brainvisa-1.0", "shared-brainvisa-1.0"],

    "attribute_definitions" : {
      "acquisition" : {"default_value" : "default_acquisition"},
      "analysis" : {"default_value" : "default_analysis"},
      "sulci_recognition_session" :  {"default_value" : "default_session"},
      "graph_version": {"default_value": "3.1"},
    },

    "shared_patterns": {
      "acquisition": "<center>/<subject>/t1mri/<acquisition>",
      "analysis": "{acquisition}/<analysis>",
      "recognition_analysis": "{analysis}/folds/<graph_version>/<sulci_recognition_session>_auto",
    },

    "processes" : {
        "CustomMorphologist" : {
            "t1mri": 
                [["input:{acquisition}/<subject>", "images"],
                # ["input:{acquisition}/normalized_<normalization>_<subject>", "images"]
                ],
            "reoriented_t1mri":
                [["output:{acquisition}/<subject>", "images"]],
            "commissure_coordinates":
                [["output:{acquisition}/<subject>", "Commissure coordinates"]],
            "t1mri_nobias":
                [["output:{analysis}/nobias_<subject>", "images" ]],
            "split_brain":
                [["output:{analysis}/segmentation/voronoi_<subject>","images"]],
            "left_graph":
                [["output:{analysis}/folds/<graph_version>/<side><subject>",
                    "Graph and data",
                    {"side": "L", "labelled": "No"}]],
            "left_labelled_graph":
                [["output:{recognition_analysis}/<side><subject>_<sulci_recognition_session>_auto",
                    "Graph and data", {"side": "L"}]],
            "right_graph":
                [["output:{analysis}/folds/<graph_version>/<side><subject>",
                    "Graph and data", {"side":"R","labelled":"No"}]],
            "right_labelled_graph":
                [["output:{recognition_analysis}/<side><subject>_<sulci_recognition_session>_auto",
                    "Graph and data", {"side": "R"}]],
            "Talairach_transform":
                [["output:{acquisition}/registration/RawT1-<subject>_<acquisition>_TO_Talairach-ACPC",
                    "Transformation matrix"]],

            # PrepareSubject

            # "PrepareSubject_Normalization_commissures_coordinates": [["input:{acquisition}/<subject>", "Commissure coordinates"]],
            # "PrepareSubject_commissure_coordinates": [["output:{acquisition}/<subject>", "Commissure coordinates"]],
            "normalization_transformation":
                [["output:{acquisition}/registration/RawT1-<subject>_<acquisition>_TO_Talairach-MNI",
                    "Transformation matrix"]],
#            "PrepareSubject_Normalization_normalized":
#                [["output:{acquisition}/normalized_<normalization>_<subject>",
#                    "images"]],
#            "reoriented_t1mri":
#                [["output:{acquisition}/<subject>", "images"]],

            ### AimsMIRegister
            "PrepareSubject_Normalization_Normalization_AimsMIRegister_anatomical_template": "{shared.anatomical_templates}",
            "PrepareSubject_Normalization_Normalization_AimsMIRegister_mni_to_acpc": "{shared.talairach_TO_spm_transform}",
            "PrepareSubject_Normalization_Normalization_AimsMIRegister_transformation_to_ACPC":
                [["output:{acquisition}/registration/RawT1-<subject>_<acquisition>_TO_Talairach-ACPC",
                    "Transformation matrix"]],

            ### NormalizeSPM
            "PrepareSubject_Normalization_NormalizeSPM_template": "{shared.anatomical_templates}",
            "normalization_spm_native_transformation": [["output:{acquisition}/<subject>_sn", "Matlab"]],
            "normalization_spm_native_job_file": [["output:{acquisition}/<subject>_job_anat_normalization", "Matlab"]],
            # "PrepareSubject_Normalization_NormalizeSPM_normalized_t1mri": [["output:{acquisition}/normalized_<normalization>_<subject>","images", {"normalization":"SPM"}]],

            #### ConvertSPMnormalizationToAIMS
            # "PrepareSubject_Normalization_NormalizeSPM_ConvertSPMnormalizationToAIMS_normalized_volume":
            #     [["output:{acquisition}/normalized_<normalization>_<subject>",
            #         "images",
            #         {"normalization": "SPM"}]],

            ### NormalizeFSL
            "normalization_fsl_native_transformation":
                [["output:{acquisition}/<subject>_fsl", "Matlab"]],
            "PrepareSubject_Normalization_NormalizeFSL_ReorientAnatomy_output_t1mri":
                [["output:{acquisition}/<subject>", "images"]],

            ### NormalizeBaladin
            "normalization_baladin_native_transformation":
                [["output:{acquisition}/<subject>_baladin", "Text file"]],

            ### TalairachFromNormalization
            "PrepareSubject_TalairachFromNormalization_source_referential": [["output:{acquisition}/registration/RawT1-<subject>_<acquisition>", "Referential" ] ],
            "PrepareSubject_TalairachFromNormalization_normalized_referential": "{shared.mni_spm_referential}",
            "PrepareSubject_TalairachFromNormalization_acpc_referential": "{shared.acpc_referential}",
            "PrepareSubject_TalairachFromNormalization_transform_chain_ACPC_to_Normalized": "{shared.talairach_TO_spm_transform}",

            #Bias Correction
            "BiasCorrection_field": [ ["output:{analysis}/biasfield_<subject>","images"] ],
            "BiasCorrection_hfiltered": [ ["output:{analysis}/hfiltered_<subject>",  "images"] ], 
            "BiasCorrection_white_ridges": [ ["output:{analysis}/whiteridge_<subject>", "images"] ], 
            "BiasCorrection_variance": [ ["output:{analysis}/variance_<subject>","images"] ], 
            "BiasCorrection_edges": [ ["output:{analysis}/edges_<subject>","images"] ], 
            "BiasCorrection_meancurvature": [ ["output:{analysis}/mean_curvature_<subject>", "images" ] ],

            #Histogram Analysis
            "HistoAnalysis_histo": [ ["output:{analysis}/nobias_<subject>", "Histogram" ] ],
            "histo_analysis": [ ["output:{analysis}/nobias_<subject>", "Histo Analysis"   ] ] ,

            #Brain Mask Segmentation
            "BrainSegmentation_brain_mask": [["output:{analysis}/segmentation/brain_<subject>","images"]],

            # Renorm
            "Renorm_skull_stripped": [["output:{analysis}/segmentation/skull_stripped_<subject>","images"]],

            # Split Brain
            "SplitBrain_split_template": [["shared:hemitemplate/closedvoronoi","GIS"]],

            #Head Mesh
            "HeadMesh_head_mesh": [["output:{analysis}/segmentation/mesh/<subject>_head", "mesh"]],
            "HeadMesh_head_mask": [["output:{analysis}/segmentation/head_<subject>", "images"]],

            #Grey/White Classification
            "GreyWhiteClassification_grey_white": [["output:{analysis}/segmentation/<side>grey_white_<subject>","images",{"side":"L"}]],
            "GreyWhiteClassification_1_grey_white": [["output:{analysis}/segmentation/<side>grey_white_<subject>","images",{"side":"R"}]],

            #Grey/White Surface
            "GreyWhiteTopology_hemi_cortex": [["output:{analysis}/segmentation/<side>cortex_<subject>","images",{"side":"L"}]],
            "GreyWhiteTopology_1_hemi_cortex": [["output:{analysis}/segmentation/<side>cortex_<subject>","images",{"side":"R"}]],

            #Grey/White Mesh
            "GreyWhiteMesh_white_mesh": [["output:{analysis}/segmentation/mesh/<subject>_<side>white","mesh",{"side":"L"}]],
            "GreyWhiteMesh_1_white_mesh": [["output:{analysis}/segmentation/mesh/<subject>_<side>white","mesh",{"side":"R"}]],

            #Pial Mesh
            "PialMesh_pial_mesh": [["output:{analysis}/segmentation/mesh/<subject>_<side>hemi","mesh",{"side":"L"}]],
            "PialMesh_1_pial_mesh": [["output:{analysis}/segmentation/mesh/<subject>_<side>hemi","mesh",{"side":"R"}]],

            #Sulci Skeleton
            "SulciSkeleton_skeleton": [["output:{analysis}/segmentation/<side>skeleton_<subject>","images",{"side":"L"}]],
            "SulciSkeleton_roots": [["output:{analysis}/segmentation/<side>roots_<subject>","images",{"side":"L"}]],
            "SulciSkeleton_1_skeleton": [["output:{analysis}/segmentation/<side>skeleton_<subject>","images",{"side":"R"}]],
            "SulciSkeleton_1_roots": [["output:{analysis}/segmentation/<side>roots_<subject>", "images", {"side": "R"}]],

            #Cortical Folds Graph
            "CorticalFoldsGraph_sulci_voronoi":
                [["output:{acquisition}/folds/<graph_version>/<side>sulcivoronoi_<subject>", "images", {"side": "L"}],
                    ["output:{analysis}/folds/<graph_version>/<side>sulcivoronoi_<subject>", "images", {"side": "L"}]],
            "CorticalFoldsGraph_cortex_mid_interface":
                [["output:{analysis}/segmentation/<side>gw_interface_<subject>","images",{"side":"L"}]],
            "CorticalFoldsGraph_1_sulci_voronoi":
                [["output:{acquisition}/folds/<graph_version>/<side>sulcivoronoi_<subject>","images",{"side": "R"}],
                    ["output:{analysis}/folds/<graph_version>/<side>sulcivoronoi_<subject>", "images",{"side":"R"}]],
            "CorticalFoldsGraph_1_cortex_mid_interface":
                [["output:{analysis}/segmentation/<side>gw_interface_<subject>","images",{ "side": "R" }] ],

            #Sulci Recognition
            ## recognition2000
            "SulciRecognition_recognition2000_model":
                [["shared:{sulci_recognition_ann_model}", "Graph and data",
                    {"side": "L", "sulci_database": "2008"}]],
            "SulciRecognition_recognition2000_energy_plot_file":
                [["output:{recognition_analysis}/<side><subject>_<sulci_recognition_session>_auto",
                    "Energy", {"side": "L"}]],
            "SulciRecognition_1_recognition2000_model":
                [["shared:{sulci_recognition_ann_model}", "Graph and data",
                    {"side": "R", "sulci_database": "2008"}]],
            "SulciRecognition_1_recognition2000_energy_plot_file":
                [["output:{recognition_analysis}/<side><subject>_<sulci_recognition_session>_auto",
                    "Energy", {"side": "R"}]],

            ## recognition09
            "SPAM_recognition_labels_translation_map": "{shared.sulci_labels_translation_map}",
            ### Global
            "SulciRecognition_SPAM_recognition09_global_recognition_labels_priors":
                [["shared:{spam_labels_priors}", "Text Data Table",
                    {"sulci_database": "2008", "side": "left"}]],
            "SulciRecognition_SPAM_recognition09_global_recognition_model":
                [["shared:{spam_distribs}", "Text Data Table",
                    {"sulci_database": "2008", "sulci_segments_model_type": "global_registered_spam", "side": "left"}]],
            "SulciRecognition_SPAM_recognition09_global_recognition_posterior_probabilities":
                [["output:{recognition_analysis}/<side><subject>_<sulci_recognition_session>_auto_proba",
                    "CSV file", {"side": "L"}]],
            "SulciRecognition_SPAM_recognition09_global_recognition_output_transformation":
                [["output:{recognition_analysis}/<side><subject>_<sulci_recognition_session>_auto_Tal_TO_SPAM",
                    "Transformation matrix", {"side": "L"}]],
            "SulciRecognition_SPAM_recognition09_global_recognition_output_t1_to_global_transformation":
                [["output:{recognition_analysis}/<side><subject>_<sulci_recognition_session>_auto_T1_TO_SPAM",
                    "Transformation matrix", {"side": "L"}]],
            "SulciRecognition_1_SPAM_recognition09_global_recognition_labels_priors":
                [["shared:{spam_labels_priors}", "Text Data Table",
                    {"sulci_database": "2008", "side": "right"}]],
            "SulciRecognition_1_SPAM_recognition09_global_recognition_model":
                [["shared:{spam_distribs}", "Text Data Table",
                    {"sulci_database": "2008", "sulci_segments_model_type": "global_registered_spam", "side": "right"}]],
            "SulciRecognition_1_SPAM_recognition09_global_recognition_posterior_probabilities":
                [["output:{recognition_analysis}/<side><subject>_<sulci_recognition_session>_auto_proba",
                    "CSV file", {"side": "R"}]],
            "SulciRecognition_1_SPAM_recognition09_global_recognition_output_transformation":
                [["output:{recognition_analysis}/<side><subject>_<sulci_recognition_session>_auto_Tal_TO_SPAM",
                    "Transformation matrix", {"side": "R"}]],
            "SulciRecognition_1_SPAM_recognition09_global_recognition_output_t1_to_global_transformation":
                [["output:{recognition_analysis}/<side><subject>_<sulci_recognition_session>_auto_T1_TO_SPAM",
                    "Transformation matrix", {"side": "R"}]],

            ### Local
            "SulciRecognition_SPAM_recognition09_local_recognition_model":
                [["shared:{spam_distribs}", "Text Data Table",
                    {"sulci_database": "2008", "sulci_segments_model_type": "locally_from_global_registred_spam", "side": "left"}]],
            "SulciRecognition_SPAM_recognition09_local_recognition_local_referentials":
                [["shared:{spam_local_referentials}", "Text Data Table",
                    {"sulci_database": "2008", "sulci_segments_model_type": "locally_from_global_registred_spam", "side": "left"}]],
            "SulciRecognition_SPAM_recognition09_local_recognition_direction_priors":
                [["shared:{spam_direction_priors}", "Text Data Table",
                    {"sulci_database": "2008", "sulci_segments_model_type": "locally_from_global_registred_spam", "side": "left"}]],
            "SulciRecognition_SPAM_recognition09_local_recognition_angle_priors":
                [["shared:{spam_angle_priors}", "Text Data Table",
                    {"sulci_database": "2008", "sulci_segments_model_type": "locally_from_global_registred_spam", "side": "left"}]],
            "SulciRecognition_SPAM_recognition09_local_recognition_translation_priors":
                [["shared:{spam_translation_priors}", "Text Data Table",
                    {"sulci_database": "2008", "sulci_segments_model_type": "locally_from_global_registred_spam", "side": "left"}]],
            "SulciRecognition_SPAM_recognition09_local_recognition_posterior_probabilities":
                [["output:{recognition_analysis}/<side><subject>_<sulci_recognition_session>_auto_proba",
                    "CSV file", {"side": "L"}]],
            "SulciRecognition_SPAM_recognition09_local_recognition_output_local_transformations":
                [["output:{recognition_analysis}/<side><subject>_<sulci_recognition_session>_auto_global_TO_local",
                    "Directory", {"side": "L"}]],
            "SulciRecognition_1_SPAM_recognition09_local_recognition_model":
                [["shared:{spam_distribs}", "Text Data Table",
                    {"sulci_database": "2008", "sulci_segments_model_type": "locally_from_global_registred_spam", "side": "right"}]],
            "SulciRecognition_1_SPAM_recognition09_local_recognition_local_referentials":
                [["shared:{spam_local_referentials}", "Text Data Table",
                    {"sulci_database": "2008", "sulci_segments_model_type": "locally_from_global_registred_spam", "side": "right"}]],
            "SulciRecognition_1_SPAM_recognition09_local_recognition_direction_priors":
                [["shared:{spam_direction_priors}", "Text Data Table",
                    {"sulci_database": "2008", "sulci_segments_model_type": "locally_from_global_registred_spam", "side": "right"}]],
            "SulciRecognition_1_SPAM_recognition09_local_recognition_angle_priors":
                [["shared:{spam_angle_priors}", "Text Data Table",
                    {"sulci_database": "2008", "sulci_segments_model_type": "locally_from_global_registred_spam", "side": "right"}]],
            "SulciRecognition_1_SPAM_recognition09_local_recognition_translation_priors":
                [["shared:{spam_translation_priors}", "Text Data Table",
                    {"sulci_database": "2008", "sulci_segments_model_type": "locally_from_global_registred_spam", "side": "right"}]],
            "SulciRecognition_1_SPAM_recognition09_local_recognition_posterior_probabilities":
                [["output:{recognition_analysis}/<side><subject>_<sulci_recognition_session>_auto_proba",
                    "CSV file", {"side": "R"}]],
            "SulciRecognition_1_SPAM_recognition09_local_recognition_output_local_transformations":
                [["output:{recognition_analysis}/<side><subject>_<sulci_recognition_session>_auto_global_TO_local",
                    "Directory", {"side": "R"}]],

            ### Markovian
            "SulciRecognition_SPAM_recognition09_markovian_recognition_model":
                [["shared:{spam_distribs}", "Text Data Table",
                    {"sulci_database": "2008", "sulci_segments_model_type": "global_registered_spam", "side": "left"}]],
            "SulciRecognition_SPAM_recognition09_markovian_recognition_segments_relations_model":
                [["shared:{spam_segments_relations_model}", "Text Data Table",
                    {"sulci_database": "2008", "side": "left"}]],
            "SulciRecognition_SPAM_recognition09_markovian_recognition_posterior_probabilities":
                [["output:{recognition_analysis}/<side><subject>_<sulci_recognition_session>_auto_proba",
                    "CSV file", {"side": "L"}]],
            "SulciRecognition_1_SPAM_recognition09_markovian_recognition_model":
                [["shared:{spam_distribs}", "Text Data Table",
                    {"sulci_database": "2008", "sulci_segments_model_type": "global_registered_spam", "side": "right"}]],
            "SulciRecognition_1_SPAM_recognition09_markovian_recognition_segments_relations_model":
                [["shared:{spam_segments_relations_model}", "Text Data Table",
                    {"sulci_database": "2008", "side": "right"}]],
            "SulciRecognition_1_SPAM_recognition09_markovian_recognition_posterior_probabilities":
                [["output:{recognition_analysis}/<side><subject>_<sulci_recognition_session>_auto_proba",
                    "CSV file", {"side": "R"}]],


        },

        #Bias Correction, internal
        "CustomMorphologist.BiasCorrection" : {
            "hfiltered": [ ["output:{analysis}/hfiltered_<subject>",  "images"] ],
            "white_ridges": [ ["output:{analysis}/whiteridge_<subject>", "images"] ],
            "variance": [ ["output:{analysis}/variance_<subject>","images"] ],
            "edges": [ ["output:{analysis}/edges_<subject>","images"] ],
        },

        "acpcOrNormalization": {
        },

        #"TalairachTransformationFromNormalization": {
            #"commissure_coordinates":
                #[["output:{acquisition}/<subject>", "Commissure coordinates"]]
        #},

        #"preparesubject": {
            #"commissure_coordinates":
                #[["output:{acquisition}/<subject>", "Commissure coordinates"]]
        #},

        "CustomMorphologist.PrepareSubject.StandardACPC": {
            # has to be re-specified here because of a problem in
            # switch back-propagation of output values
            "reoriented_t1mri":
                [["output:{acquisition}/<subject>", "images"]],
        },

        "CustomMorphologist.PrepareSubject.Normalization.NormalizeSPM": {
            "normalized_t1mri":
                [["output:{acquisition}/normalized_SPM_<subject>",
                    ["NIFTI", "SPM"]]],
            # has to be re-specified here because of a problem in
            # switch back-propagation of output values
            "reoriented_t1mri":
                [["output:{acquisition}/<subject>", "images"]],
        },

        "CustomMorphologist.PrepareSubject.Normalization.NormalizeFSL": {
            # has to be re-specified here because of a problem in
            # switch back-propagation of output values
            "reoriented_t1mri":
                [["output:{acquisition}/<subject>", "images"]],
        },

        "CustomMorphologist.PrepareSubject.Normalization.NormalizeBaladin": {
            # has to be re-specified here because of a problem in
            # switch back-propagation of output values
            "reoriented_t1mri":
                [["output:{acquisition}/<subject>", "images"]],
        }
    }
}
